USE [CDP]
GO

DECLARE @sendUuidIndex INT = 1
DECLARE @perSendUuidCount INT = 1
DECLARE @totalCount INT = 1
DECLARE @SendUuid NVARCHAR(100) = CONCAT(N'Send-', REPLACE(CONVERT(NVARCHAR(36), NEWID()), '-', ''), '-', @sendUuidIndex)

-- 插入104筆假資料，共用 SendUuid
WHILE @totalCount <= 104
BEGIN
    INSERT INTO [dbo].[Workflow] (
        [WorkflowUuid], [SendUuid], [BatchId], [CdpUuid], [ActivityId], [ActivityName],
        [ActivityStatus], [NodeId], [NodeName], [Channel], [ChannelType],
        [UploadFileName], [ProgressStatus], [CreateAt], [UpdateAt],
        [JourneyCreateAt], [JourneyUpdateAt], [JourneyFinishAt],
        [GroupSendCreateAt], [GroupSendUpdateAt], [SendUuidSort],[Message]
    )
    VALUES (
        NEWID(), -- WorkflowUuid
        @SendUuid, -- 共用 SendUuid
        CONCAT(N'Batch-', @totalCount),
        CONCAT(N'CDP-', @totalCount),
        CONCAT(N'Act-', @totalCount),
        CONCAT(N'活動名稱-', @totalCount),
        CASE WHEN @totalCount % 3 = 0 THEN N'Completed' ELSE N'Progress' END,
        CONCAT(N'Node-', @totalCount),
        CASE WHEN @totalCount % 2 = 0 THEN N'發送 Email' ELSE N'發送簡訊' END,
        CASE WHEN @totalCount % 2 = 0 THEN N'EDM' ELSE N'SMS' END,
        CASE WHEN @totalCount % 4 = 0 THEN N'Journey' ELSE N'GroupSend' END,
        CONCAT(N'upload_', @totalCount, N'.csv'),
        CASE WHEN @totalCount % 4 = 0 THEN N'CDP' ELSE N'MailHunter' END,
        DATEADD(SECOND, @perSendUuidCount, GETDATE()),
        GETDATE(),
        DATEADD(DAY, -@totalCount, GETDATE()),
        DATEADD(DAY, -@totalCount + 1, GETDATE()),
        DATEADD(DAY, -@totalCount + 2, GETDATE()),
        DATEADD(DAY, -@totalCount, GETDATE()),
        DATEADD(DAY, -@totalCount + 1, GETDATE()),
        0,
		NULL
    )

    -- 控制每個 SendUuid 插入 10 筆
    SET @perSendUuidCount += 1
    IF @perSendUuidCount > 10
    BEGIN
        SET @perSendUuidCount = 1
        SET @sendUuidIndex += 1
        SET @SendUuid = CONCAT(N'Send-', REPLACE(CONVERT(NVARCHAR(36), NEWID()), '-', ''), '-', @sendUuidIndex)
    END

    SET @totalCount += 1
END
GO
